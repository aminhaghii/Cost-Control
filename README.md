# Pareto Inventory & Cost Control (Single-Hotel)

نسخه‌ی فعلی پروژه فقط برای یک هتل طراحی و اجرا می‌شود. تمام توضیحات این سند بر اساس همین وضعیت نوشته شده و شامل تمام بخش‌های پروژه است تا هیچ قسمتی جا نماند.

## فهرست مطالب
1. معرفی پروژه و هدف‌ها
2. وضعیت تک‌هتل و فلسفه طراحی
3. ساختار کلی سیستم و معماری اجرا
4. مسیرهای اصلی سامانه و نقش هر صفحه
5. راه‌اندازی کامل روی ویندوز
6. تنظیمات محیطی و امنیتی
7. ساختار پوشه‌ها و فایل‌های مهم
8. مدل داده و قوانین موجودی
9. تعریف واحدها و واحدهای سفارشی
10. مدیریت کالاها (ادمین)
11. ثبت تراکنش و قواعد قیمت‌گذاری
12. داشبورد عمومی
13. داشبورد انبار و مدیریت هشدارها
14. شمارش موجودی و اصلاحات
15. گزارش‌ها و خروجی اکسل
16. وارد کردن اکسل و جلوگیری از تکرار
17. هوش مصنوعی و پیشنهاد سفارش
18. امنیت، دسترسی و 2FA
19. نگهداشت، بکاپ و پایداری
20. خطاهای رایج و راه‌حل‌ها
21. نقشه راه آینده
22. محل قرار دادن اسکرین‌شات‌ها

---

## 1) معرفی پروژه و هدف‌ها
این سیستم برای مدیریت موجودی هتل طراحی شده است. تمرکز اصلی روی دقت موجودی، ثبت کامل تراکنش‌ها، تحلیل هزینه و امکان تصمیم‌گیری سریع مدیران است. کل سیستم با زبان فارسی طراحی شده تا کاربر نهایی نیاز به ترجمه نداشته باشد.

هدف‌های کلیدی:
- ثبت دقیق خرید، مصرف، ضایعات و اصلاحات
- محاسبه موجودی بر اساس تراکنش‌های واقعی
- تحلیل هزینه با پارتو و ABC
- داشبوردهای مدیریتی برای کنترل سریع
- ورود/خروج امن همراه با محدودیت تلاش ناموفق

---

## 2) وضعیت تک‌هتل و فلسفه طراحی
سیستم در حالت تک‌هتل اجرا می‌شود. یعنی همه کاربران یک مجموعه داده مشترک دارند و فیلترهای چند هتل غیرفعال شده‌اند. این تصمیم برای سادگی عملیات، کاهش خطا و تمرکز بر یک موجودی واحد اتخاذ شده است.

نکات مهم:
- جدول Hotel همچنان وجود دارد، اما فیلترهای مربوط به آن در سرویس‌ها و داشبورد حذف شده‌اند.
- تمام آیتم‌های فعال بدون توجه به هتل شمرده می‌شوند.
- در آینده امکان بازگرداندن چند‌هتل وجود دارد اما در این نسخه غیرفعال است.

---

## 3) ساختار کلی سیستم و معماری اجرا
کل سیستم یک برنامه Flask است که با Blueprints بخش‌بندی شده است. مسیرها به سرویس‌ها متصل می‌شوند و سرویس‌ها با مدل‌های SQLAlchemy کار می‌کنند. دیتابیس SQLite است و در حالت WAL اجرا می‌شود تا هم‌زمانی بهتر داشته باشد.

جریان کلی:
کاربر → صفحه‌های وب (templates) → route → service → مدل‌ها → دیتابیس

---

## 4) مسیرهای اصلی سامانه و نقش هر صفحه
مسیرهای اصلی پروژه به این شکل هستند:
- صفحه ورود: login
- داشبورد اصلی: صفحه ریشه
- داشبورد انبار: warehouse
- لیست کالاها: admin/items و warehouse/items
- ثبت تراکنش: transactions/create
- گزارش‌ها: reports/pareto و reports/abc
- هوش مصنوعی: ai/reorder-suggestions و ai/analyze-pareto و ai/waste-analysis

تمام مسیرها در پوشه routes تعریف شده‌اند.

---

## 5) راه‌اندازی کامل روی ویندوز
برای راه‌اندازی نیاز به Python نسخه 3.12 دارید. سپس مراحل زیر را انجام دهید:
1. پروژه را دانلود کنید.
2. محیط مجازی بسازید.
3. محیط را فعال کنید.
4. نیازمندی‌ها را نصب کنید.
5. فایل تنظیمات محیطی بسازید.
6. دیتابیس را بسازید یا نمونه‌داده وارد کنید.
7. برنامه را اجرا کنید.

این مراحل باید دقیق انجام شوند تا خطاهای وابستگی یا دیتابیس به وجود نیاید.

---

## 6) تنظیمات محیطی و امنیتی
تنظیمات در فایل config قرار دارد و با متغیرهای محیطی تکمیل می‌شود. موارد اصلی:
- کلید امن سشن برای جلوگیری از نفوذ
- محیط اجرا (توسعه یا تولید)
- نرخ محدودیت درخواست
- کلید هوش مصنوعی برای فعال شدن تحلیل‌ها

این متغیرها باید در فایل .env ذخیره شوند تا در اجرای برنامه خوانده شوند.

---

## 7) ساختار پوشه‌ها و فایل‌های مهم
پوشه‌های کلیدی پروژه:
- app.py: نقطه ورود اصلی
- config.py: تنظیمات امنیت و دیتابیس
- models: تعریف جدول‌ها و قوانین
- routes: تعریف صفحات و مسیرها
- services: منطق محاسبات و تحلیل‌ها
- templates: رابط کاربری
- scripts: اسکریپت‌های آماده‌سازی
- tests: تست‌ها و سناریوهای سخت‌گیری
- database: فایل اصلی دیتابیس

---

## 8) مدل داده و قوانین موجودی
مدل‌های اصلی عبارت‌اند از:
- User: کاربران، نقش‌ها و امنیت
- Item: کالاها، واحدها و موجودی
- Transaction: ثبت خرید، مصرف، ضایعات و اصلاحات
- ImportBatch: مدیریت ایمپورت اکسل و جلوگیری از تکرار
- Alert: هشدارهای موجودی و تاییدها

قانون طلایی موجودی:
موجودی برابر مجموع مقدار امضا شده همه تراکنش‌هاست و نباید دستی تغییر کند.

---

## 9) تعریف واحدها و واحدهای سفارشی
واحدهای پایه در مدل Item تعریف شده‌اند (کیلوگرم، لیتر، عدد، متر). اگر واحد جدیدی وارد شود و در لیست نباشد، سیستم با ضریب 1 آن را می‌پذیرد تا ثبت کالا متوقف نشود. این رفتار برای انعطاف عملیاتی فعال شده است.

---

## 10) مدیریت کالاها (ادمین)
ادمین می‌تواند کالا اضافه کند، ویرایش کند و وضعیت فعال یا غیرفعال را تغییر دهد. هنگام ایجاد کالا، موجودی اولیه با یک تراکنش اصلاحی ثبت می‌شود تا قوانین موجودی حفظ شود.

---

## 11) ثبت تراکنش و قواعد قیمت‌گذاری
همه تراکنش‌ها از مسیر ثبت تراکنش انجام می‌شوند. قیمت واحد اگر با قیمت پایه متفاوت باشد و کاربر مجاز نباشد، سیستم دلیل تغییر قیمت را می‌خواهد. برای کاربران بدون مجوز، تغییر قیمت ممنوع است.

---

## 12) داشبورد عمومی
داشبورد عمومی خلاصه خرید امروز، ضایعات، مصرف و تعداد اقلام را نمایش می‌دهد. نمودار پارتو و روند خرید ۷ روز اخیر نیز نمایش داده می‌شوند.

---

## 13) داشبورد انبار و مدیریت هشدارها
داشبورد انبار شامل:
- تعداد اقلام
- ارزش موجودی
- تعداد اقلام کم‌موجودی
- هشدارهای فعال و تاییدهای معلق
در این نسخه تک‌هتل، این آمار برای همه کالاهای فعال محاسبه می‌شود.

---

## 14) شمارش موجودی و اصلاحات
بخش شمارش موجودی برای تطبیق موجودی واقعی با سیستم طراحی شده است. اگر اختلاف باشد، تراکنش اصلاحی ثبت می‌شود و دلیل آن ذخیره می‌گردد.

---

## 15) گزارش‌ها و خروجی اکسل
گزارش‌های پارتو و ABC در بخش reports قرار دارند. خروجی اکسل برای تحلیل‌های مدیریتی تولید می‌شود.

---

## 16) وارد کردن اکسل و جلوگیری از تکرار
فایل اکسل با هش فایل کنترل می‌شود. اگر فایل تکراری باشد، از ایمپورت مجدد جلوگیری می‌شود مگر اینکه Replace Mode فعال شود.

---

## 17) هوش مصنوعی و پیشنهاد سفارش
صفحه پیشنهاد سفارش، تحلیل مصرف و موجودی را بررسی می‌کند و لیست پیشنهادی برای سفارش مجدد ارائه می‌دهد. صفحات AI دیگر شامل تحلیل پارتو و تحلیل ضایعات هستند.

---

## 18) امنیت، دسترسی و 2FA
سیستم شامل محدودیت تعداد تلاش، قفل حساب، امکان فعال‌سازی 2FA، و ثبت کامل لاگ‌های امنیتی است.

---

## 19) نگهداشت، بکاپ و پایداری
برای بکاپ کافی است فایل دیتابیس را به صورت دوره‌ای کپی کنید. بهتر است قبل از هر تغییر بزرگ، یک نسخه پشتیبان گرفته شود.

---

## 20) خطاهای رایج و راه‌حل‌ها
برخی خطاها شامل نبودن جدول‌ها، نبودن پکیج‌ها، یا صفر بودن آمار داشبورد هستند که معمولاً با ساخت دیتابیس، نصب وابستگی‌ها و ری‌استارت سرور حل می‌شوند.

---

## 21) نقشه راه آینده
1. مستندسازی API برای اتصال با سیستم‌های مالی
2. بهبود تست‌های end-to-end
3. تحلیل‌های پیشرفته‌تر AI در داشبورد انبار

---

## 22) محل قرار دادن اسکرین‌شات‌ها
لطفاً اسکرین‌شات‌ها را در پوشه README_IMAGES قرار دهید و در این بخش لینک دهید.

Screenshot Placeholder: داشبورد اصلی
Screenshot Placeholder: داشبورد انبار
Screenshot Placeholder: صفحه مدیریت کالاها
Screenshot Placeholder: صفحه ثبت تراکنش
Screenshot Placeholder: صفحه پیشنهاد سفارش AI
 
پایان سند

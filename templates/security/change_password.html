{% extends 'base.html' %}

{% block title %}تغییر رمز عبور{% endblock %}

{% block content %}
<div class="page-header">
    <h2><i class="fas fa-key me-2"></i> تغییر رمز عبور</h2>
</div>

<div class="row justify-content-center">
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <form method="POST" id="changePasswordForm">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-lock me-1"></i> رمز عبور فعلی
                        </label>
                        <input type="password" name="current_password" class="form-control" required>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">
                            <i class="fas fa-key me-1"></i> رمز عبور جدید
                        </label>
                        <input type="password" name="new_password" id="newPassword" class="form-control" required minlength="8">
                        <div id="passwordStrength" class="mt-2"></div>
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label fw-bold">
                            <i class="fas fa-redo me-1"></i> تکرار رمز عبور جدید
                        </label>
                        <input type="password" name="confirm_password" id="confirmPassword" class="form-control" required>
                        <div id="passwordMatch" class="mt-1"></div>
                    </div>
                    
                    <div class="alert alert-info small">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>الزامات رمز عبور:</strong>
                        <ul class="mb-0 mt-2">
                            <li>حداقل ۸ کاراکتر</li>
                            <li>حداقل یک عدد</li>
                            <li>حداقل یک حرف بزرگ انگلیسی</li>
                        </ul>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i> ذخیره رمز جدید
                        </button>
                        <a href="{{ url_for('security.security_settings') }}" class="btn btn-outline-secondary">
                            انصراف
                        </a>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const newPassword = document.getElementById('newPassword');
    const confirmPassword = document.getElementById('confirmPassword');
    const strengthDiv = document.getElementById('passwordStrength');
    const matchDiv = document.getElementById('passwordMatch');
    
    newPassword.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        let messages = [];
        
        if (password.length >= 8) strength++;
        else messages.push('حداقل ۸ کاراکتر');
        
        if (/[0-9]/.test(password)) strength++;
        else messages.push('یک عدد');
        
        if (/[A-Z]/.test(password)) strength++;
        else messages.push('یک حرف بزرگ');
        
        if (/[a-z]/.test(password)) strength++;
        
        if (/[^A-Za-z0-9]/.test(password)) strength++;
        
        let color = 'danger';
        let text = 'ضعیف';
        
        if (strength >= 4) { color = 'success'; text = 'قوی'; }
        else if (strength >= 3) { color = 'warning'; text = 'متوسط'; }
        
        if (password.length === 0) {
            strengthDiv.innerHTML = '';
        } else {
            strengthDiv.innerHTML = `<small class="text-${color}"><i class="fas fa-shield-alt me-1"></i>قدرت: ${text}</small>`;
            if (messages.length > 0) {
                strengthDiv.innerHTML += `<br><small class="text-muted">نیاز به: ${messages.join('، ')}</small>`;
            }
        }
        
        checkMatch();
    });
    
    confirmPassword.addEventListener('input', checkMatch);
    
    function checkMatch() {
        if (confirmPassword.value.length === 0) {
            matchDiv.innerHTML = '';
            return;
        }
        
        if (newPassword.value === confirmPassword.value) {
            matchDiv.innerHTML = '<small class="text-success"><i class="fas fa-check me-1"></i>رمزها مطابقت دارند</small>';
        } else {
            matchDiv.innerHTML = '<small class="text-danger"><i class="fas fa-times me-1"></i>رمزها مطابقت ندارند</small>';
        }
    }
});
</script>
{% endblock %}
